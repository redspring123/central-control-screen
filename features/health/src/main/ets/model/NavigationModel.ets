// src/main/ets/model/NavigationModel.ts (ç¡®è®¤è¿™éƒ¨åˆ†ä»£ç )
import router from '@ohos.router';
import promptAction from '@ohos.promptAction';
import call from '@ohos.telephony.call';

export class NavigationModel {
  static goBack() {
    router.back();
  }

  static handleJump(key: string) {
    let targetUrl = '';
    let params: Record<string, Object> = {};

    switch (key) {
      case 'btn_one_key_call':
        try {
          promptAction.showDialog({
            title: 'ä¸€é”®å‘¼å«',
            message: 'æ˜¯å¦ç«‹å³å‘¼å«å®¶åº­åŒ»ç”Ÿï¼Ÿ',
            buttons: [
              { text: 'å–æ¶ˆ', color: '#8E8E93' },
              { text: 'ç«‹å³å‘¼å«', color: '#FF3B30' }
            ]
          }, (err, data) => {
            if (err) {
              console.error('showDialog err: ' + err);
              return;
            }
            if (data.index === 1) {
              promptAction.showToast({ message: 'æ­£åœ¨å‘¼å«å®¶åº­åŒ»ç”Ÿ...', duration: 2000 });
              // å°è¯•ä½¿ç”¨ç³»ç»Ÿæ‹¨å·
              call.makeCall('13800000000', (err) => {
                if (err) {
                  console.error('makeCall fail, err: ' + JSON.stringify(err));
                  // å¦‚æœç³»ç»Ÿæ‹¨å·å¤±è´¥ï¼ˆå¦‚æ— simå¡ï¼‰ï¼Œåˆ™è·³è½¬åˆ°æ¨¡æ‹Ÿé¡µé¢
                  try {
                    router.pushNamedRoute({ name: 'CallPage' });
                  } catch (e) {
                    console.error('pushNamedRoute CallPage failed', e);
                    promptAction.showToast({ message: 'è·³è½¬å¤±è´¥ï¼Œè¯·æ£€æŸ¥è·¯ç”±é…ç½®' });
                  }
                }
              });
            }
          });
        } catch (error) {
          console.error('showDialog error: ' + error);
        }
        break;
      case 'card_consult':
        // è·³è½¬åˆ°åœ¨çº¿é—®è¯Šé¡µé¢
        try {
          router.pushNamedRoute({
            name: 'MedicalOnlineConsultPage',
            params: params
          }, router.RouterMode.Single, (err) => {
            if (err) {
              console.error(`è·³è½¬å¤±è´¥: ${err.code}, ${err.message}`);
              try { promptAction.showToast({ message: `è·³è½¬å¤±è´¥: ${err.message}` }); } catch (e) { console.error('showToast failed', e); }
            }
          });
        } catch (e) {
          console.error('router.pushNamedRoute threw', e);
          try { promptAction.showToast({ message: 'è·³è½¬å¤±è´¥' }); } catch (err) { console.error('showToast failed', err); }
        }
        break;
      case 'btn_sport_health':
        // ä»å¥åº·æ¨¡å—å†…éƒ¨è·³è½¬åˆ°è¿åŠ¨å¥åº·é¡µï¼ˆä½¿ç”¨å‘½åè·¯ç”±ï¼‰
        try {
          router.pushNamedRoute({
            name: 'HealthSportsPage',
            params: params
          }, router.RouterMode.Single, (err) => {
            if (err) {
              console.error(`è·³è½¬å¤±è´¥: ${err.code}, ${err.message}`);
              try { promptAction.showToast({ message: `è·³è½¬å¤±è´¥(${err.code}): ${err.message}` }); } catch (e) { console.error('showToast failed', e); }
            }
          });
        } catch (e) {
          console.error('router.pushNamedRoute threw', e);
          try { promptAction.showToast({ message: 'è·³è½¬å¤±è´¥' }); } catch (err) { console.error('showToast failed', err); }
        }
        break;
      // src/main/ets/model/NavigationModel.ts

      case 'card_edu':
        // ä½¿ç”¨å‘½åè·¯ç”±è·³è½¬åˆ°å¥åº·è®ºå›
        try {
          router.pushNamedRoute({
            name: 'HealthForumPage', // ğŸ”´ å…³é”®ï¼šè¿™é‡Œè¦å¡«ä½ åœ¨ ForumPage é‡Œå®šä¹‰çš„åå­—
            params: params
          }, router.RouterMode.Single, (err) => {
            if (err) {
              console.error(`è·³è½¬è®ºå›å¤±è´¥: code ${err.code}, msg ${err.message}`);
              try { promptAction.showToast({ message: `è·³è½¬å¤±è´¥: ${err.message}` }); } catch (e) {}
            }
          });
        } catch (e) {
          console.error('è·³è½¬è®ºå›å¼‚å¸¸:', e);
          try { promptAction.showToast({ message: 'è·³è½¬å¼‚å¸¸' }); } catch (e) {}
        }
        break;
      // ... å…¶ä»– case å¯ä»¥åªå†™ breakï¼Œé»˜è®¤ä¸åšååº”æˆ–å¼¹ "å¼€å‘ä¸­"
      default:
        promptAction.showToast({ message: 'åŠŸèƒ½å¼€å‘ä¸­' });
        break;
    }

    // å¦‚æœæœ‰ url åˆ™è·³è½¬
    if (targetUrl) {
      try {
        router.pushUrl({ url: targetUrl, params: params });
      } catch (e) {
        console.error('router.pushUrl threw', e);
        try { promptAction.showToast({ message: 'è·³è½¬å¤±è´¥' }); } catch (err) { console.error('showToast failed', err); }
      }
    }
  }
}